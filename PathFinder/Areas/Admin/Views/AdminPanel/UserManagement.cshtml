@using PathFinder.ViewModels.UserViewModels
@model UsersIndexViewModel

@{
    ViewData["Title"] = "User Management";
}

<h2 class="text-center mb-4" id="user-management-title">@ViewData["Title"]</h2>

<div class="user-management-container">
    @foreach (var user in Model.Users)
    {
        <div class="user-card" id="user-card-@user.Id">
            <div class="user-info">
                <h5>@user.Email</h5>
                <small>ID: @user.Id</small>
                <p><strong>Roles:</strong> @string.Join(", ", user.Roles)</p>
            </div>
            <div class="user-actions">
                <form method="post" asp-action="AssignRole" class="user-role-form">
                    <input type="hidden" name="userId" value="@user.Id" />
                    <div class="form-group">
                        <select name="role" class="form-select">
                            <option value="" disabled selected>Select Role</option>
                            <option value="PFUser">PFUser</option>
                            <option value="Admin">Admin</option>
                            <option value="Institution">Institution</option>
                            <option value="Company">Company</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Assign</button>
                </form>

                <form method="post" asp-action="RemoveRole" class="user-role-form">
                    <input type="hidden" name="userId" value="@user.Id" />
                    <div class="form-group">
                        <select name="role" class="form-select">
                            <option value="" disabled selected>Select Role</option>
                            @foreach (var role in user.Roles)
                            {
                                <option value="@role">@role</option>
                            }
                        </select>
                    </div>
                    <button type="submit" class="btn btn-warning">Remove</button>
                </form>

                <form method="post" asp-action="DeleteUser" class="user-action-form">
                    <input type="hidden" name="userId" value="@user.Id" />
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    }
</div>

<div class="pagination-container">
    @if (Model.CurrentPage > 1)
    {
        <a asp-action="UserManagement" asp-route-pageNumber="@(Model.CurrentPage - 1)" class="pagination-btn">&laquo;</a>
    }

    @for (int i = 1; i <= Model.TotalPages; i++)
    {
        <a asp-action="UserManagement" asp-route-pageNumber="@i" class="pagination-btn @(i == Model.CurrentPage ? "active" : "")">@i</a>
    }

    @if (Model.CurrentPage < Model.TotalPages)
    {
        <a asp-action="UserManagement" asp-route-pageNumber="@(Model.CurrentPage + 1)" class="pagination-btn">&raquo;</a>
    }
</div>